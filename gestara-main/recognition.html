<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ISL Recognition ‚Äî GESTARA</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    /* Page Specific Styles for Video Overlays */
    .video-wrapper {
        position: relative;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    #webcam {
        width: 100%;
        display: block;
        transform: scaleX(-1); /* Mirror effect */
    }

    .overlay-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(0,0,0,0.75);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        backdrop-filter: blur(4px);
    }

    .letter-display {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--accent, #FF6B6B);
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        font-size: 2.5rem;
        font-weight: 700;
        min-width: 80px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .confidence-bar {
        position: absolute;
        bottom: 15px;
        left: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.8);
        padding: 12px;
        border-radius: 8px;
        backdrop-filter: blur(4px);
    }

    .conf-fill {
        height: 8px;
        background: linear-gradient(90deg, #ff4444, #ffaa00, #00ff88);
        border-radius: 4px;
        transition: width 0.2s ease-out;
    }

    .conf-text {
        color: #fff;
        margin-top: 6px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    /* Sentence Box Styling */
    .sentence-display {
        background: #fff;
        border: 2px solid #eee;
        border-radius: 12px;
        padding: 16px;
        font-size: 1.25rem;
        min-height: 70px;
        font-weight: 600;
        color: var(--deep, #333);
        word-wrap: break-word;
        margin-top: 1rem;
    }

    .current-word-label {
        color: #666;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }

    /* Suggestions Grid */
    .sug-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 1rem;
    }

    .sug-btn {
        background: var(--accent, #FF6B6B);
        color: white;
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    
    .sug-btn:hover {
        transform: translateY(-2px);
        opacity: 0.9;
    }

    /* Control Button Stack */
    .control-stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  
  <header class="header container" role="banner">
    <div class="brand" tabindex="0">
      <div class="logo" aria-hidden="true">GA</div>
      <div>
        <div style="font-weight:700; color:var(--deep)">GESTARA</div>
        <div class="kv">Real-time Recognition</div>
      </div>
    </div>
    <nav role="navigation" aria-label="Primary navigation" style="margin-top:12px">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="recognition.html" aria-current="page" style="font-weight:700">ISL</a></li>
        <li><a href="text_to_sign.html">Text to Sign</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main id="main" class="container" role="main">
    <h1 id="rec-title">Real-Time Sign Language to Text</h1>
    
    <section aria-label="Recognition Area" class="hero-card">
      <p class="kv">Sign letters to spell words with smart autocomplete.</p>

      <div style="display:flex; gap:20px; margin-top:16px; flex-wrap:wrap">
        
        <div style="flex:1; min-width:300px">
            <div class="video-wrapper">
                <video id="webcam" autoplay playsinline muted></video>
                
                <div class="overlay-badge" id="status">‚ö™ Not Started</div>
                <div class="letter-display" id="letter">-</div>
                
                <div class="confidence-bar">
                    <div class="conf-fill" id="conf-fill" style="width: 0%"></div>
                    <div class="conf-text" id="conf-text">Confidence: 0%</div>
                </div>
            </div>

            <div class="sentence-display" id="sentence">Start signing...</div>
            <div class="current-word-label" id="word">Current word: <span></span></div>
        </div>

        <div style="width:320px">
          <div style="background:#f9f9f9; padding:16px; border-radius:12px; height: 100%;">
            
            <h3>Controls</h3>
            <div class="control-stack">
                <button class="btn" id="start-btn">üé• Start Camera</button>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                    <button class="btn secondary" id="add-btn" disabled>‚ûï Add</button>
                    <button class="btn secondary" id="space-btn" disabled>‚éµ Space</button>
                </div>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                    <button class="btn secondary" id="del-btn" disabled>‚å´ Delete</button>
                    <button class="btn secondary" id="clear-btn" disabled>üóëÔ∏è Clear</button>
                </div>
            </div>

            <div style="margin-top: 24px; border-top: 1px solid #e0e0e0; padding-top: 16px;">
                <h3>Word Suggestions</h3>
                <div class="sug-grid" id="suggestions">
                    <div style="color: #999; font-size: 0.9rem; padding: 10px;">
                        Sign letters to see suggestions
                    </div>
                </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <footer style="margin-top:18px">
      <a class="btn secondary" href="index.html">Back to Home</a>
    </footer>
  </main>

  <script>
        const API = 'http://localhost:5000';
        
        class ISL {
            constructor() {
                this.webcam = document.getElementById('webcam');
                this.running = false;
                this.sentence = '';
                this.word = '';
                this.letter = '';
                this.confidence = 0;
                
                this.init();
            }
            
            init() {
                document.getElementById('start-btn').onclick = () => this.toggle();
                document.getElementById('add-btn').onclick = () => this.add();
                document.getElementById('del-btn').onclick = () => this.del();
                document.getElementById('space-btn').onclick = () => this.space();
                document.getElementById('clear-btn').onclick = () => this.clear();
                
                document.addEventListener('keydown', e => {
                    if (!this.running) return;
                    if (e.key === ' ') { e.preventDefault(); this.add(); }
                    else if (e.key === 'Backspace') { e.preventDefault(); this.del(); }
                    else if (e.key === 'Enter') { e.preventDefault(); this.space(); }
                });
            }
            
            async toggle() {
                if (!this.running) await this.start();
                else this.stop();
            }
            
            async start() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    this.webcam.srcObject = stream;
                    this.running = true;
                    
                    document.getElementById('start-btn').textContent = '‚èπÔ∏è Stop';
                    document.getElementById('add-btn').disabled = false;
                    document.getElementById('del-btn').disabled = false;
                    document.getElementById('space-btn').disabled = false;
                    document.getElementById('clear-btn').disabled = false;
                    document.getElementById('status').textContent = 'üü¢ Active';
                    
                    this.loop();
                } catch (e) {
                    alert('Camera error: ' + e.message);
                }
            }
            
            stop() {
                if (this.webcam.srcObject) {
                    this.webcam.srcObject.getTracks().forEach(t => t.stop());
                }
                this.running = false;
                document.getElementById('start-btn').textContent = 'üé• Start Camera';
                document.getElementById('status').textContent = '‚ö™ Stopped';
            }
            
            async loop() {
                if (!this.running) return;
                
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = this.webcam.videoWidth;
                    canvas.height = this.webcam.videoHeight;
                    canvas.getContext('2d').drawImage(this.webcam, 0, 0);
                    
                    const img = canvas.toDataURL('image/jpeg', 0.7);
                    
                    const res = await fetch(API + '/predict-letter', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ image: img })
                    });
                    
                    const data = await res.json();
                    
                    if (data.success) {
                        this.letter = data.letter;
                        this.confidence = data.confidence;
                        
                        document.getElementById('letter').textContent = this.letter;
                        document.getElementById('conf-fill').style.width = (this.confidence * 100) + '%';
                        document.getElementById('conf-text').textContent = 'Confidence: ' + Math.round(this.confidence * 100) + '%';
                    } else {
                        document.getElementById('letter').textContent = '?';
                        document.getElementById('conf-text').textContent = 'No hand detected';
                    }
                } catch (e) {
                    console.error(e);
                }
                
                setTimeout(() => this.loop(), 200);
            }
            
            add() {
                if (this.letter && this.confidence > 0.6) {
                    this.word += this.letter;
                    this.update();
                    this.suggest();
                }
            }
            
            del() {
                if (this.word) this.word = this.word.slice(0, -1);
                else if (this.sentence) this.sentence = this.sentence.slice(0, -1);
                this.update();
                this.suggest();
            }
            
            space() {
                if (this.word) {
                    this.sentence += this.word + ' ';
                    this.word = '';
                    this.update();
                    this.clearSug();
                }
            }
            
            clear() {
                this.sentence = '';
                this.word = '';
                this.update();
                this.clearSug();
            }
            
            selectWord(w) {
                this.sentence += w + ' ';
                this.word = '';
                this.update();
                this.clearSug();
            }
            
            update() {
                document.getElementById('sentence').textContent = this.sentence + this.word || 'Start signing...';
                document.getElementById('word').innerHTML = 'Current word: <span>' + (this.word || '(empty)') + '</span>';
            }
            
            async suggest() {
                if (this.word.length < 2) {
                    this.clearSug();
                    return;
                }
                
                try {
                    const res = await fetch(API + '/suggest-words', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ current_input: this.word.toLowerCase(), max_suggestions: 12 })
                    });
                    
                    const data = await res.json();
                    
                    if (data.success && data.suggestions.length > 0) {
                        const grid = document.getElementById('suggestions');
                        grid.innerHTML = '';
                        data.suggestions.forEach(w => {
                            const btn = document.createElement('button');
                            btn.className = 'sug-btn';
                            btn.textContent = w;
                            btn.onclick = () => this.selectWord(w);
                            grid.appendChild(btn);
                        });
                    } else {
                        this.clearSug();
                    }
                } catch (e) {
                    console.error(e);
                }
            }
            
            clearSug() {
                document.getElementById('suggestions').innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #999; padding: 2rem;">Sign more letters</div>';
            }
        }
        
        new ISL();
    </script>
</body>
</html>